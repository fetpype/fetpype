
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../api_nodes/">
      
      
        <link rel="next" href="../api_utils/">
      
      
        
      
      
      <link rel="icon" href="../media/fetpype_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Pipelines - Fetpype</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/home.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Fetpype" class="md-header__button md-logo" aria-label="Fetpype" data-md-component="logo">
      
  <img src="../media/fetpype_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fetpype
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipelines
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Fetpype" class="md-nav__button md-logo" aria-label="Fetpype" data-md-component="logo">
      
  <img src="../media/fetpype_logo.png" alt="logo">

    </a>
    Fetpype
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    In-depth
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    In-depth
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../input_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BIDS Input Data Preparation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../output_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Output Data Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_parts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running parts of the pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Pipeline
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pipeline
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reconstruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reconstruction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segmentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../surface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Surface Extraction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nodes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Pipelines
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipelines
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        full_pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="full_pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_prepro" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_prepro
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_recon" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_recon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_seg" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_seg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_surf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_surf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_full_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_full_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_rec_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_rec_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_seg_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_seg_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_surf_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_surf_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_dhcp_subpipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dhcp_subpipe
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        full_pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="full_pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_prepro" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_prepro
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_recon" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_recon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_seg" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_seg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.get_surf" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_surf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_full_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_full_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_rec_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_rec_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_seg_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_seg_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_surf_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_surf_pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetpype.pipelines.full_pipeline.create_dhcp_subpipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dhcp_subpipe
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="pipelines">Pipelines</h1>


<div class="doc doc-object doc-module">



<h2 id="fetpype.pipelines.full_pipeline" class="doc doc-heading">
            <code>full_pipeline</code>


</h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.get_prepro" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_prepro</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enabled_cropping</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create the preprocessing workflow based on config <code>cfg</code>.
Given an input of T2w stacks, this pipeline performs the following steps:
    1. Brain extraction using MONAIfbs
    2. Check stacks and masks
    3. Check affine and resolution of stacks and masks
    4. Cropping stacks and masks
    5. Denoising stacks
    6. Bias field correction of stacks</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_masks</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean indicating whether to load masks or
        perform brain extraction.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enabled_cropping</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean indicating whether cropping is enabled.
                This is typically set to False for SVRTK
                pipelines, as they handle cropping internally.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>prepro_pipe</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Nipype workflow object that contains
            the preprocessing steps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_prepro</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enabled_cropping</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the preprocessing workflow based on config `cfg`.</span>
<span class="sd">    Given an input of T2w stacks, this pipeline performs the following steps:</span>
<span class="sd">        1. Brain extraction using MONAIfbs</span>
<span class="sd">        2. Check stacks and masks</span>
<span class="sd">        3. Check affine and resolution of stacks and masks</span>
<span class="sd">        4. Cropping stacks and masks</span>
<span class="sd">        5. Denoising stacks</span>
<span class="sd">        6. Bias field correction of stacks</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">        load_masks: Boolean indicating whether to load masks or</span>
<span class="sd">                    perform brain extraction.</span>
<span class="sd">        enabled_cropping:   Boolean indicating whether cropping is enabled.</span>
<span class="sd">                            This is typically set to False for SVRTK</span>
<span class="sd">                            pipelines, as they handle cropping internally.</span>

<span class="sd">    Returns:</span>
<span class="sd">        prepro_pipe:    A Nipype workflow object that contains</span>
<span class="sd">                        the preprocessing steps.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfg_prepro</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">preprocessing</span>

    <span class="n">prepro_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Preprocessing&quot;</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>

    <span class="n">enabled_check</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">check_stacks_and_masks</span><span class="o">.</span><span class="n">enabled</span>
    <span class="n">enabled_cropping</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">cropping</span><span class="o">.</span><span class="n">enabled</span> <span class="ow">and</span> <span class="n">enabled_cropping</span>
    <span class="k">if</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">cropping</span><span class="o">.</span><span class="n">enabled</span> <span class="o">!=</span> <span class="n">enabled_cropping</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overriding cropping enabled status for the selected pipeline.&quot;</span><span class="p">)</span>
    <span class="n">enabled_denoising</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enabled_bias_corr</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">bias_correction</span><span class="o">.</span><span class="n">enabled</span>

    <span class="c1"># PREPROCESSING</span>
    <span class="c1"># 0. Define input and outputs</span>
    <span class="n">in_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stacks&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">in_fields</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">in_fields</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span>
    <span class="p">)</span>
    <span class="c1"># 1. Load masks or brain extraction</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span>
    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">check_input</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
            <span class="n">interface</span><span class="o">=</span><span class="n">CheckAndSortStacksAndMasks</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;CheckInput&quot;</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">be_config</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">brain_extraction</span>
        <span class="n">be_cfg_cont</span> <span class="o">=</span> <span class="n">be_config</span><span class="p">[</span><span class="n">container</span><span class="p">]</span>

        <span class="n">brain_extraction</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
            <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
                <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;input_stacks&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_masks&quot;</span><span class="p">],</span>
                <span class="n">function</span><span class="o">=</span><span class="n">run_prepro_cmd</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;BrainExtraction&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">brain_extraction</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">be_cfg_cont</span><span class="o">.</span><span class="n">cmd</span>
        <span class="n">brain_extraction</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">be_config</span>
        <span class="c1"># if the container is singularity, add</span>
        <span class="c1"># singularity path to the brain_extraction</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">brain_extraction</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
            <span class="n">brain_extraction</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>

    <span class="c1"># 2. Check stacks and masks</span>
    <span class="n">check_name</span> <span class="o">=</span> <span class="s2">&quot;CheckAffineAndRes&quot;</span>
    <span class="n">check_name</span> <span class="o">+=</span> <span class="s2">&quot;_disabled&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled_check</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="n">check_affine</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">CheckAffineResStacksAndMasks</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">check_name</span>
    <span class="p">)</span>
    <span class="n">check_affine</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="n">enabled_check</span>
    <span class="c1"># 3. Cropping</span>
    <span class="n">cropping_name</span> <span class="o">=</span> <span class="s2">&quot;Cropping&quot;</span>
    <span class="n">cropping_name</span> <span class="o">+=</span> <span class="s2">&quot;_disabled&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled_cropping</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cropping</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">CropStacksAndMasks</span><span class="p">(),</span>
        <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="n">cropping_name</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cropping</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="n">enabled_cropping</span>
    <span class="c1"># 4. Denoising</span>
    <span class="n">denoising_name</span> <span class="o">=</span> <span class="s2">&quot;Denoising&quot;</span>
    <span class="n">denoising_name</span> <span class="o">+=</span> <span class="s2">&quot;_disabled&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled_denoising</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="n">denoising</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_stacks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;is_enabled&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_stacks&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_prepro_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input_stacks&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="n">denoising_name</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">denoising_cfg</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">denoising</span>
    <span class="n">denoising</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="n">enabled_denoising</span>
    <span class="n">denoising</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">denoising_cfg</span><span class="p">[</span><span class="n">container</span><span class="p">]</span><span class="o">.</span><span class="n">cmd</span>
    <span class="c1"># if the container is singularity, add singularity path to the denoising</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">denoising</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">denoising</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>

    <span class="n">merge_denoise</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ravel_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MergeDenoise&quot;</span>
    <span class="p">)</span>
    <span class="c1"># 5. Bias field correction</span>
    <span class="n">bias_name</span> <span class="o">=</span> <span class="s2">&quot;BiasCorrection&quot;</span>
    <span class="n">bias_name</span> <span class="o">+=</span> <span class="s2">&quot;_disabled&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled_bias_corr</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="n">bias_corr</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_stacks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;input_masks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;is_enabled&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_stacks&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_prepro_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input_stacks&quot;</span><span class="p">,</span> <span class="s2">&quot;input_masks&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="n">bias_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bias_cfg</span> <span class="o">=</span> <span class="n">cfg_prepro</span><span class="o">.</span><span class="n">bias_correction</span>
    <span class="n">bias_corr</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">is_enabled</span> <span class="o">=</span> <span class="n">enabled_bias_corr</span>
    <span class="n">bias_corr</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">bias_cfg</span><span class="p">[</span><span class="n">container</span><span class="p">]</span><span class="o">.</span><span class="n">cmd</span>

    <span class="c1"># if the container is singularity, add singularity path to the bias_corr</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bias_corr</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">bias_corr</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>

    <span class="c1"># 6. Verify output</span>
    <span class="n">check_output</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">CheckAndSortStacksAndMasks</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;CheckOutput&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Connect nodes</span>

    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="n">check_input</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">)</span>
        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">,</span> <span class="n">check_input</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>

        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">check_input</span><span class="p">,</span> <span class="s2">&quot;output_stacks&quot;</span><span class="p">,</span> <span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span>
        <span class="p">)</span>
        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">check_input</span><span class="p">,</span> <span class="s2">&quot;output_masks&quot;</span><span class="p">,</span> <span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="n">brain_extraction</span><span class="p">,</span> <span class="s2">&quot;input_stacks&quot;</span><span class="p">)</span>

        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">)</span>
        <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">brain_extraction</span><span class="p">,</span> <span class="s2">&quot;output_masks&quot;</span><span class="p">,</span> <span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span>
        <span class="p">)</span>

    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;output_stacks&quot;</span><span class="p">,</span> <span class="n">cropping</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">check_affine</span><span class="p">,</span> <span class="s2">&quot;output_masks&quot;</span><span class="p">,</span> <span class="n">cropping</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">)</span>

    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="s2">&quot;output_image&quot;</span><span class="p">,</span> <span class="n">denoising</span><span class="p">,</span> <span class="s2">&quot;input_stacks&quot;</span><span class="p">)</span>
    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">denoising</span><span class="p">,</span> <span class="s2">&quot;output_stacks&quot;</span><span class="p">,</span> <span class="n">merge_denoise</span><span class="p">,</span> <span class="s2">&quot;in1&quot;</span><span class="p">)</span>

    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">merge_denoise</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">bias_corr</span><span class="p">,</span> <span class="s2">&quot;input_stacks&quot;</span><span class="p">)</span>
    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="s2">&quot;output_mask&quot;</span><span class="p">,</span> <span class="n">bias_corr</span><span class="p">,</span> <span class="s2">&quot;input_masks&quot;</span><span class="p">)</span>

    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">bias_corr</span><span class="p">,</span> <span class="s2">&quot;output_stacks&quot;</span><span class="p">,</span> <span class="n">check_output</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">)</span>
    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cropping</span><span class="p">,</span> <span class="s2">&quot;output_mask&quot;</span><span class="p">,</span> <span class="n">check_output</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>

    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">check_output</span><span class="p">,</span> <span class="s2">&quot;output_stacks&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">)</span>
    <span class="n">prepro_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">check_output</span><span class="p">,</span> <span class="s2">&quot;output_masks&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prepro_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.get_recon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_recon</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the reconstruction workflow based on the pipeline specified
in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rec_pipe</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Nipype workflow object that contains
        the reconstruction steps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_recon</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the reconstruction workflow based on the pipeline specified</span>
<span class="sd">    in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rec_pipe:   A Nipype workflow object that contains</span>
<span class="sd">                    the reconstruction steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rec_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Reconstruction&quot;</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>
    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;srr_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span>
    <span class="n">cfg_reco_base</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">reconstruction</span>
    <span class="n">cfg_reco</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">reconstruction</span><span class="p">[</span><span class="n">container</span><span class="p">]</span>

    <span class="n">recon</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_stacks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;input_masks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cfg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;srr_volume&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_recon_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">cfg_reco_base</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">recon</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">cfg_reco</span><span class="o">.</span><span class="n">cmd</span>
    <span class="n">recon</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg_reco_base</span>
    <span class="c1"># if the container is singularity, add singularity path to the recon node</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">recon</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">recon</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>

    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="s2">&quot;input_stacks&quot;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;masks&quot;</span><span class="p">,</span> <span class="s2">&quot;input_masks&quot;</span><span class="p">)]),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;srr_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;srr_volume&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rec_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.get_seg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_seg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the segmentation workflow based on the pipeline specified
in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    seg_pipe:   A Nipype workflow object that contains
                the segmentation steps.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_seg</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the segmentation workflow based on the pipeline specified</span>
<span class="sd">    in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">    Returns:</span>
<span class="sd">        seg_pipe:   A Nipype workflow object that contains</span>
<span class="sd">                    the segmentation steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seg_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;srr_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>
    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;seg_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span>
    <span class="n">cfg_seg_base</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">segmentation</span>
    <span class="n">cfg_seg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">segmentation</span><span class="p">[</span><span class="n">container</span><span class="p">]</span>

    <span class="n">seg</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_srr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cfg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_home&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;seg_volume&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_seg_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">cfg_seg_base</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">cfg_seg</span><span class="o">.</span><span class="n">cmd</span>
    <span class="n">seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg_seg_base</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_home</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_home</span>

    <span class="n">seg_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;srr_volume&quot;</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="s2">&quot;input_srr&quot;</span><span class="p">)</span>
    <span class="n">seg_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="s2">&quot;seg_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;seg_volume&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">seg_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.get_surf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_surf</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the surface extraction workflow based on the pipeline specified
in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    surf_pipe:   A Nipype workflow object that contains
                the surface extraction steps.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_surf</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the surface extraction workflow based on the pipeline specified</span>
<span class="sd">    in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">    Returns:</span>
<span class="sd">        surf_pipe:   A Nipype workflow object that contains</span>
<span class="sd">                    the surface extraction steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">surf_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;SurfaceExtraction&quot;</span><span class="p">)</span>

    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;seg_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;surf_volume_lh&quot;</span><span class="p">,</span> <span class="s2">&quot;surf_volume_rh&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span>
    <span class="n">cfg_surf_base</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">surface</span>
    <span class="n">cfg_surf</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">surface</span><span class="p">[</span><span class="n">container</span><span class="p">]</span>

    <span class="c1"># surf_lh</span>
    <span class="n">surf_lh</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_seg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cfg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_home&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;surf_volume&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_surf_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;surf_lh&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">surf_lh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">cfg_surf</span><span class="o">.</span><span class="n">cmd</span>
    <span class="n">surf_lh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg_surf_base</span><span class="o">.</span><span class="n">surface_lh</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">surf_lh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">surf_lh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>
        <span class="n">surf_lh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_home</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_home</span>

    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;seg_volume&quot;</span><span class="p">,</span> <span class="n">surf_lh</span><span class="p">,</span> <span class="s2">&quot;input_seg&quot;</span><span class="p">)</span>
    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">surf_lh</span><span class="p">,</span> <span class="s2">&quot;surf_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;surf_volume_lh&quot;</span><span class="p">)</span>

    <span class="c1"># surf_rh</span>
    <span class="n">surf_rh</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;input_seg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cfg&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_mount&quot;</span><span class="p">,</span>
                <span class="s2">&quot;singularity_home&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;surf_volume&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">run_surf_cmd</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;surf_rh&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">surf_rh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="n">cfg_surf</span><span class="o">.</span><span class="n">cmd</span>
    <span class="n">surf_rh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg_surf_base</span><span class="o">.</span><span class="n">surface_rh</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">container</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">surf_rh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_path</span>
        <span class="n">surf_rh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_mount</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_mount</span>
        <span class="n">surf_rh</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">singularity_home</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">singularity_home</span>

    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;seg_volume&quot;</span><span class="p">,</span> <span class="n">surf_rh</span><span class="p">,</span> <span class="s2">&quot;input_seg&quot;</span><span class="p">)</span>
    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">surf_rh</span><span class="p">,</span> <span class="s2">&quot;surf_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;surf_volume_rh&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">surf_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.create_full_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_full_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;full_pipeline&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a full fetal processing pipeline by combining preprocessing,
reconstruction, and segmentation workflows.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_masks</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean indicating whether to load masks or perform
        brain extraction.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pipeline (default = "full_pipeline").</p>
              </div>
            </td>
            <td>
                  <code>&#39;full_pipeline&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>full_fet_pipe</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Nipype workflow object that contains
            the full pipeline steps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_full_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;full_pipeline&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a full fetal processing pipeline by combining preprocessing,</span>
<span class="sd">    reconstruction, and segmentation workflows.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">        load_masks: Boolean indicating whether to load masks or perform</span>
<span class="sd">                    brain extraction.</span>
<span class="sd">        name: Name of the pipeline (default = &quot;full_pipeline&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        full_fet_pipe:  A Nipype workflow object that contains</span>
<span class="sd">                        the full pipeline steps.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Full pipeline name: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Creating pipeline</span>
    <span class="n">full_fet_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="n">config</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>

    <span class="n">in_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stacks&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">in_fields</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span>

    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">in_fields</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_srr&quot;</span><span class="p">,</span> <span class="s2">&quot;output_seg&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;output_surf_lh&quot;</span><span class="p">,</span> <span class="s2">&quot;output_surf_rh&quot;</span><span class="p">]</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">enabled_cropping</span> <span class="o">=</span> <span class="p">(</span>
        <span class="kc">False</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">reconstruction</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">==</span> <span class="s2">&quot;svrtk&quot;</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">prepro_pipe</span> <span class="o">=</span> <span class="n">get_prepro</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="p">,</span> <span class="n">enabled_cropping</span><span class="p">)</span>
    <span class="n">recon</span> <span class="o">=</span> <span class="n">get_recon</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">get_seg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="n">surface</span> <span class="o">=</span> <span class="n">get_surf</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># PREPROCESSING</span>
    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;inputnode.stacks&quot;</span><span class="p">)</span>

    <span class="c1"># RECONSTRUCTION</span>
    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;outputnode.stacks&quot;</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;inputnode.stacks&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;outputnode.masks&quot;</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;inputnode.masks&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;outputnode.srr_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_srr&quot;</span>
    <span class="p">)</span>

    <span class="c1"># SEGMENTATION</span>
    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;outputnode.srr_volume&quot;</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="s2">&quot;inputnode.srr_volume&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">segmentation</span><span class="p">,</span> <span class="s2">&quot;outputnode.seg_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_seg&quot;</span>
    <span class="p">)</span>

    <span class="c1"># SURFACE EXTRACTION</span>
    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">segmentation</span><span class="p">,</span> <span class="s2">&quot;outputnode.seg_volume&quot;</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;inputnode.seg_volume&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;outputnode.surf_volume_lh&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_surf_lh&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;outputnode.surf_volume_rh&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_surf_rh&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">full_fet_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.create_rec_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_rec_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rec_pipeline&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create the reconstruction workflow based on the pipeline specified
in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_masks</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean indicating whether to load masks or perform
        brain extraction.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pipeline (default = "rec_pipeline").</p>
              </div>
            </td>
            <td>
                  <code>&#39;rec_pipeline&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rec_pipe</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Nipype workflow object that contains the
      reconstruction steps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_rec_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rec_pipeline&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the reconstruction workflow based on the pipeline specified</span>
<span class="sd">    in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">        load_masks: Boolean indicating whether to load masks or perform</span>
<span class="sd">                    brain extraction.</span>
<span class="sd">        name: Name of the pipeline (default = &quot;rec_pipeline&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        rec_pipe: A Nipype workflow object that contains the</span>
<span class="sd">                  reconstruction steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Full pipeline name: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Creating pipeline</span>
    <span class="n">rec_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="n">rec_pipe</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>
    <span class="n">in_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stacks&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">in_fields</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">in_fields</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">enabled_cropping</span> <span class="o">=</span> <span class="p">(</span>
        <span class="kc">False</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">reconstruction</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">==</span> <span class="s2">&quot;svrtk&quot;</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">prepro_pipe</span> <span class="o">=</span> <span class="n">get_prepro</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">load_masks</span><span class="p">,</span> <span class="n">enabled_cropping</span><span class="p">)</span>
    <span class="n">recon</span> <span class="o">=</span> <span class="n">get_recon</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;stacks&quot;</span><span class="p">,</span> <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;inputnode.stacks&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">load_masks</span><span class="p">:</span>
        <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">,</span> <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;inputnode.masks&quot;</span><span class="p">)</span>
    <span class="c1"># RECONSTRUCTION</span>

    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;outputnode.stacks&quot;</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;inputnode.stacks&quot;</span>
    <span class="p">)</span>
    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">prepro_pipe</span><span class="p">,</span> <span class="s2">&quot;outputnode.masks&quot;</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;inputnode.masks&quot;</span><span class="p">)</span>

    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_srr&quot;</span><span class="p">,</span> <span class="s2">&quot;output_seg&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rec_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">recon</span><span class="p">,</span> <span class="s2">&quot;outputnode.srr_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_srr&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rec_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.create_seg_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_seg_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;seg_pipeline&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create the segmentation workflow based on the pipeline specified
in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pipeline (default = "seg_pipeline").</p>
              </div>
            </td>
            <td>
                  <code>&#39;seg_pipeline&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    seg_pipe: A Nipype workflow object that contains the segmentation steps</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_seg_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;seg_pipeline&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the segmentation workflow based on the pipeline specified</span>
<span class="sd">    in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">        name: Name of the pipeline (default = &quot;seg_pipeline&quot;).</span>
<span class="sd">    Returns:</span>
<span class="sd">        seg_pipe: A Nipype workflow object that contains the segmentation steps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Full pipeline name: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Creating pipeline</span>
    <span class="n">seg_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="n">seg_pipe</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;srr_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">get_seg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="n">seg_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;srr_volume&quot;</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="s2">&quot;inputnode.srr_volume&quot;</span>
    <span class="p">)</span>

    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_seg&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">seg_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">segmentation</span><span class="p">,</span> <span class="s2">&quot;outputnode.seg_volume&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_seg&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">seg_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.create_surf_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_surf_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;surf_pipeline&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create the surface extraction workflow based on the pipeline
specified in the config <code>cfg</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration object containing the parameters for the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the pipeline (default = "surf_pipeline").</p>
              </div>
            </td>
            <td>
                  <code>&#39;surf_pipeline&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    surf_pipe: A Nipype workflow object that contains the
        surface extraction steps</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_surf_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;surf_pipeline&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the surface extraction workflow based on the pipeline</span>
<span class="sd">    specified in the config `cfg`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: Configuration object containing the parameters for the pipeline.</span>
<span class="sd">        name: Name of the pipeline (default = &quot;surf_pipeline&quot;).</span>
<span class="sd">    Returns:</span>
<span class="sd">        surf_pipe: A Nipype workflow object that contains the</span>
<span class="sd">            surface extraction steps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Full pipeline name: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Creating pipeline</span>
    <span class="n">surf_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="n">surf_pipe</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;seg_volume&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">surface</span> <span class="o">=</span> <span class="n">get_surf</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;seg_volume&quot;</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;inputnode.seg_volume&quot;</span><span class="p">)</span>

    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output_surf_lh&quot;</span><span class="p">,</span> <span class="s2">&quot;output_surf_rh&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;outputnode.surf_volume_lh&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_surf_lh&quot;</span>
    <span class="p">)</span>

    <span class="n">surf_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">surface</span><span class="p">,</span> <span class="s2">&quot;outputnode.surf_volume_rh&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;output_surf_rh&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">surf_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetpype.pipelines.full_pipeline.create_dhcp_subpipe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_dhcp_subpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dhcp_pipe&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Deprecated: Create a dHCP pipeline for fetal brain segmentation
and surface extraction.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>fetpype/pipelines/full_pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_dhcp_subpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;dhcp_pipe&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deprecated: Create a dHCP pipeline for fetal brain segmentation</span>
<span class="sd">    and surface extraction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Full pipeline name: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># Creating pipeline</span>
    <span class="n">full_fet_pipe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Creating input node</span>
    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;gestational_age&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inputnode&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Check params to see if we need to run the seg or surf part, or both.</span>
    <span class="c1"># Params to look is [dhcp][seg] and [dhcp][surf]</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;dhcp&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dhcp&quot;</span><span class="p">][</span><span class="s2">&quot;surf&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dhcp&quot;</span><span class="p">][</span><span class="s2">&quot;seg&quot;</span><span class="p">]:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;-all&quot;</span>
        <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dhcp&quot;</span><span class="p">][</span><span class="s2">&quot;seg&quot;</span><span class="p">]:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;-seg&quot;</span>
        <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dhcp&quot;</span><span class="p">][</span><span class="s2">&quot;surf&quot;</span><span class="p">]:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;-surf&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No dhcp parameters found, running both seg and surf&quot;</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;-all&quot;</span>

    <span class="c1"># PREPROCESSING</span>
    <span class="c1"># 1. Run the dhcp pipeline for segmentation</span>
    <span class="n">dhcp_seg</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;T2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mask&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gestational_age&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pre_command&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dhcp_image&quot;</span><span class="p">,</span>
                <span class="s2">&quot;threads&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flag&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dhcp_files&quot;</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="n">dhcp_pipeline</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dhcp_seg&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;general&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">dhcp_seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">pre_command</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pre_command&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">dhcp_seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">dhcp_image</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dhcp_image&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;dhcp&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">dhcp_seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">threads</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dhcp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">dhcp_seg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="n">dhcp_seg</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">)</span>
    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="n">dhcp_seg</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">inputnode</span><span class="p">,</span> <span class="s2">&quot;gestational_age&quot;</span><span class="p">,</span> <span class="n">dhcp_seg</span><span class="p">,</span> <span class="s2">&quot;gestational_age&quot;</span>
    <span class="p">)</span>

    <span class="c1"># OUTPUT</span>
    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dhcp_files&quot;</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outputnode&quot;</span>
    <span class="p">)</span>

    <span class="n">full_fet_pipe</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dhcp_seg</span><span class="p">,</span> <span class="s2">&quot;dhcp_files&quot;</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="s2">&quot;dhcp_files&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">full_fet_pipe</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>